---
title: "Análisis Exploratorio: `mtcars` (con Apéndice: stock diario 2019-2022)"
author: "Marcos"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: journal
    highlight: tango
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
params: 
  mostrar_apendice: true
---

```{r setup, include=FALSE}
# --- Configuración global ---------------------------------------
knitr::opts_chunk$set(
  echo = FALSE,    # no mostrar código en el documento final
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 5
)

# Librerías necesarias
library(tidyverse)
library(knitr)
library(kableExtra)
library(DT)
library(ggplot2)
library(lubridate)
```

# Índice

> El documento incluye un índice (TOC) personalizado que muestra hasta **nivel 2** de encabezados.
> Si quieres cambiar la profundidad, edita `toc_depth` en el encabezado YAML.

# 1. Introducción

Este informe presenta un **análisis exploratorio** del conjunto de datos `mtcars`, con el objetivo de **visualizar relaciones clave**, presentar los datos en tablas (estática e interactiva) y aplicar una **presentación cuidada**.

**Objetivos principales:**

1. Cargar y explorar `mtcars`.
2. Presentar una **tabla estática** con `kable` y una **tabla interactiva** con `DT`.
3. Generar al menos un gráfico que muestre relaciones relevantes (por ejemplo, consumo `mpg` vs peso `wt`).
4. Personalizar el documento para una buena presentación.

**Puntos clave que se abordarán:**

* Descripción breve del dataset.
* Tablas (kable + DT).
* Gráficos y análisis por grupos.
* Conclusiones.

# 2. Carga y descripción del dataset

```{r carga-datos}
# Cargar datos (mtcars ya viene con R)
data("mtcars")
df <- mtcars %>%
  rownames_to_column(var = "modelo") %>%
  as_tibble()

# Añadimos columnas útiles: cilindros como factor y transmisión legible
df <- df %>%
  mutate(
    cyl = factor(cyl),
    am = factor(am, labels = c("Automático", "Manual")),
    gear = factor(gear)
  )
```

## 2.1 Vista rápida y resumen

```{r preview}
# Mostrar las primeras filas con kable (tabla estática)
df %>%
  slice_head(n = 10) %>%
  kable(
    caption = "Primeras 10 filas de `mtcars`",
    digits = 2,
    format = "html"
  ) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped","hover","condensed"))
```

```{r resumen}
# Resumen numérico básico
summary_df <- df %>%
  select(-modelo) %>%
  summary()
# imprimir como texto (salida compacta)
summary_df
```

# 3. Tablas interactivas

```{r tabla-interactiva}
# Tabla interactiva completa con DT
datatable(
  df,
  extensions = c('Buttons','Responsive'),
  options = list(
    pageLength = 10,
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
    responsive = TRUE
  ),
  rownames = FALSE
)
```

# 4. Análisis y visualizaciones

En esta sección exploramos relaciones interesantes. Nos centraremos en **mpg (millas por galón)** frente a **peso (wt)**, coloreando por número de cilindros (`cyl`) y diferenciando por tipo de transmisión (`am`).

```{r grafico-mpg-wt}
# Gráfico: mpg vs wt, coloreado por cilindros, forma por transmisión
g <- ggplot(df, aes(x = wt, y = mpg, color = cyl, shape = am)) +
  geom_point(size = 3, alpha = 0.9) +
  geom_smooth(method = "lm", se = TRUE, aes(group = 1), linetype = "dashed") +
  labs(
    title = "Relación mpg vs peso (wt)",
    subtitle = "Puntos coloreados por número de cilindros; forma por tipo de transmisión",
    x = "Peso (1000 lb)",
    y = "Millas por galón (mpg)",
    color = "Cilindros",
    shape = "Transmisión"
  ) +
  theme_minimal(base_size = 12)
print(g)
```

## 4.1 Análisis por número de cilindros

```{r resumen-por-cyl}
res_cyl <- df %>%
  group_by(cyl) %>%
  summarise(
    n = n(),
    mpg_med = mean(mpg),
    mpg_sd = sd(mpg),
    wt_med = mean(wt)
  ) %>%
  arrange(desc(mpg_med))

# Mostrar con kable
res_cyl %>%
  kable(
    caption = "Resumen por número de cilindros",
    digits = 2,
    format = "html"
  ) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped","hover"))
```

# 5. Conclusiones

* Existe una **clara relación negativa** entre *peso* (`wt`) y *consumo* (`mpg`): a mayor peso, menor mpg.
* Los automóviles con **menos cilindros** presentan, en promedio, **mayor mpg**.
* La visualización y las tablas permiten identificar modelos concretos con buen equilibrio de peso y consumo para análisis posteriores.

---